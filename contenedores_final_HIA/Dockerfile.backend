# base image
FROM node:lts-alpine3.22

# Instalar git y netcat (usado por el entrypoint para esperar la DB)
RUN apk add --no-cache git netcat-openbsd postgresql-client

# Establecer el directorio de trabajo
WORKDIR /usr/src/app

# Clonar el repositorio de la aplicaci칩n
RUN git clone https://github.com/ignaMartin22/tpfinal_hia.git .

# Cambiar al directorio del backend
# Cuando se clona el repo en '.', el backend queda en '/usr/src/app/backend'
WORKDIR /usr/src/app/backend

# Instalar dependencias de la aplicaci칩n
RUN npm install

# Copiar entrypoint que espera a la DB antes de iniciar la app
COPY entrypoint.sh /usr/local/bin/entrypoint.sh
RUN chmod +x /usr/local/bin/entrypoint.sh

# Exponer el puerto en el que la aplicaci칩n se ejecutar치
EXPOSE 3000

# Usa entrypoint para esperar la DB y luego ejecutar la app
ENTRYPOINT ["/usr/local/bin/entrypoint.sh"]
